
sudo: required

services:
  - docker

env:
  global:
    - secure: jaY9Jd3/qUYRYUo+5Nffe/QUC/TdQ/Daw45eIOh5vlmJ/gjReAHLATPT+RgiSjJK1qN25W83nHpjrdrx0Ot6RmuWJsM2AHFSTyHF+5GdK/UCak95Q1er5iLv7yr6lWKye916vvs+w3VqGGr8szpnbZ3BrMcnR2+hjLOs9tJAbJ7V4e/tYTgrYLoz6tW49eQkgNU5yDVYi1Sl7c+sA6TILf8fMzRJ8dtYh7RAOElh3TlwWENFlRBRg8b7cqSley4wO/7KJdUNK6nJiEKNAffKJVZ6HEwvmI7rBah5RaBXemTmF5sdsWe7oJGsTM7xPQj98OGLhm28lb8dBuu4mPSOJduiwx7OJUswOvF0ILq01eDe18GutyGx87NMt4578E7d6Dp9vrashzEMgFdSF4IO6OeX94wT97JampJ86oBjsDJ+5TFTciFf5Kfdh4DBvAoeRAmUHkl3FSaHKlROiQiy+AKQtEVhWErj+VvGNDrgFSbeJ+qGMbMKJDtKTVOGHSea0NgEMedSK5AxakqqNZnJna3I4cXG7i4hIFFLEVrHg5bb60TDdgwwanZ7eh3yRS90bvhqnI5y7IKrcoAI03+xjxWPNeJT3A3Gaqd1vgNrJQxJ61PPnZo6aVohjhB+WZMe6pwp8xSTjU7WcueVEu/02JAm6ObDpA1asxlRVJM7zTI= # DOCKER_EMAIL
    - secure: KfQ/uxg2c7wZ7zJHAlJptfKyEBkLR7K75lBVwxYTBWaWWtPXkaY6NFGynNT5sVe/W4g/LFdGxRGniqzI4qDbQboL2lNpiwYpcK7HiKDYZujI6rop6Ccd536RbGPp46xX3PUHBYuM2KRc4URTprNRMRvW116bpqqOvs01elJRCzcTM46hs+jR3MVKSauedhSf/Wbbds7RyFjtnePDtf9k1W/ySq2L6IKYXwiFq2pBMJLymrup1EQc/R+Dbmdg1ej6wreEaLd2fRLIQJAAyJdnJlpuirzCA69SufUbRBex1QTvefYYZMGbrNSpX0KSiDYpkCp0mnMhcTxlOZaHUQ/b22Sa2+pKdYeHkFT78bcXv1ZJvmNuqIt8ao9sA46BmVYSxjF4l4gX30dY2b0jUMiTp3YBzUQC17hm7qaZzqJXDpsHSG01fV+cCSVCWxoNGIcPp8lsMEERnkSh34JpyoU+1ZNUNKpQCX6CWzDT+JdBPz9B7yndhc0Dn4z53Jx/CvisjYeDznRHg0C7VjhDWbeTDEov5qwBraVYAtWnIR+kCnWELDtpqLu1MZ5bHpsytmayr/k5qVpqDhqjv70B9fkDFTjtU+mEnm+I83B68ci4Xv0xh6shalZiKdLbAS0BBPMd++aDThekj2U5DddP6PNVwIIsUgdsRuzEMkW/JGRCZXA= # DOCKER_USER
    - secure: DczYvJuhbYsFvLxlkxcyusw9ZFynE433BkpebSJbY/xlfgiwxWrTSX+8w45lwENUtrUgYSt9uaoghAbdmOLLonFreYbmyGHoHsB7n7fOAxGHfb7N8ayjlQssKYhRtNWR9w6eIG4eZGVcN+mDwZljBZ7tjdGucm0J9pfbSSlX+0LUbCVJIcOL3kN6uPaYV4914k6eJUnU2gW92B0BEuPfYou3k0nxNkiAwSRqBKM9vP6hWuIqhrOQt6gecxl/ZznuPfaIDNw91yvX+SfFVqdeeziMCQRxUAY7on06EeuLNLruHqho1OsU8mjfL5Duy29ui1T1Oc9vYY62rBDzE2fqFyGW1cODc/8h35LlCiNpJ0FLHMu2HvRoskQKU7ekhWsss8mxrHA4BY2pp5YSf3Xnfh/hMqZWhiYol/XdQrGKGuXnPqrzNsAqtjo1boavNQwQYBhOG+gevALlkgakjc+TcltLfxRNTeQMwtW6MqjzYdJlii2uSkZYxs1q+6BKCwpyqX+VRqsYz7lk/0GAldNNR45j7g0r4qNY5PV7TTYg+sO1P1nwtXsrZmjW6/DiWDS66cI9F/+VnwfdflCmfQ+CAmQw6C8jrTVMjc71P84Kw1hxiHVaj06NLoO9rEY+NknCgv8sps3lnuXiFk23O8M6p2y+LV4biihEBOVoAT+/bvE= # DOCKER_PASS
    - COMMIT=${TRAVIS_COMMIT::8}

after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=tanmaniac/opencv3-cudagl
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build --tag $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO